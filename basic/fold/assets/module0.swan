-- version swan: 2025.0 graph: 2.0
{text%function foldTest <<m>> (acc: 'T; arr: 'T ^m)
      returns (o0: 'T) where 'T numeric 
      {
      let o0 = (fold (
          function (acc: 'T; elem: 'T) returns (o: 'T) {
              let o = acc + elem;
          }
      )) <<m>> (acc, arr);
      }%text}

function test ()
  returns (o0: int32;)
{
  diagram
    (#0 block foldTest <<3>> 
              #pragma diagram {"xy":"H2450;V-10750","wh":"20000;14000"} #end)
    (#1 expr 0
    #pragma diagram {"xy":"H-27450;V-7250"} #end)
    (#2 expr 2 ^ 3
    #pragma diagram {"xy":"H-28450;V-14250","wh":"10000;3200"} #end)
    (#3 def o0
    #pragma diagram {"xy":"H31950;V-10750"} #end)
    
    (#4 wire #1 => #0 .(1))
    (#5 wire #2 => #0 .(2))
    (#6 wire #0 => #3
    #pragma diagram {"wp":"v0|#0 #3"} #end)
}

function foldTest_g <<M>> (acc: 'T;
                           arr : 'T^M;)
  returns (o: 'T;)
  where 'T numeric
{
  diagram
    (#0 block (fold ({op_expr%function acc, elem => acc + elem%op_expr})) <<M>>
    #pragma diagram {"xy":"H-8375;V-7925","wh":"24000;17975"} #end)
    (#2 def o
    #pragma diagram {"xy":"H23125;V-7925"} #end)
    (#3 expr acc
    #pragma diagram {"xy":"H-40275;V-3431"} #end)
    (#4 expr arr
    #pragma diagram {"xy":"H-40275;V-12419"} #end)
    
    (#5 wire #3 => #0 .(1))
    (#6 wire #4 => #0 .(2)
    #pragma diagram {"wp":"#4 h9450 v1734 #0"} #end)
    (#7 wire #0 => #2
    #pragma diagram {"wp":"v-1988|#0 #2"} #end)
}
